{% extends "base.html" %}
{% set category = "leden" %}
{% block title %}Members{% endblock %}
{% block head %}
    {{ super() }}
    {% from "_macros.html" import tablesorter %}
    {{ tablesorter('#members') }}
{% endblock %}
{% block content %}
<table id="members">
    <thead>
        <tr>
            <th>name</th>
            <th>date of birth</th>
            <th>email</th>
            <th>telephone</th>
            <th>address</th>
            <th>member since</th>
            <th>roles</th>
            <th>dues</th>
            {% if hasrole(session.user_id, 'finances') %}<th>bar account balance</th>{% endif %}
            {% if hasrole(session.user_id, 'members') %}<th>modify</th>{% endif %}
        </tr>
    </thead>
    <tbody>
{%- for user in users %}
        <tr>
            <td>{{ user.name }}</td>
            <td>{{ user.date_of_birth }}</td>
            <td>
                {%- if user.show_email or hasrole(session.user_id, 'members') -%}{{- user.email -}}{%- else -%} hidden {%- endif -%}
                {%- if not user.show_email and hasrole(session.user_id, 'members')  %} (hidden){%- endif -%}
            </td>
            <td>
                {%- if user.show_telephone or hasrole(session.user_id, 'members') -%}{{- user.telephone -}}{%- else -%} hidden {%- endif -%}
                {%- if not user.show_telephone and hasrole(session.user_id, 'members') %} (hidden){%- endif -%}
            </td>
            <td>{{ user.street }} {{ user.number }}{% if user.bus %} {{ user.bus }}{% endif %}, {{ user.postalcode }} {{ user.city }}</td>
            <td>{{ user.member_since }}</td>
            <td>
                {%- set i = user.roles|length -%}
                {%- for perm in user.roles|sort -%}
                    {% if perm != 'membership' %}
                        {{perm}}
                        {%- if i > 1 -%},{%- endif -%}
                    {% endif %}
                    {%- set i = i - 1 -%}
                {%- endfor -%}
            </td>
            <td>â‚¬{{ user.membership_dues }}</td>
            {% if hasrole(session.user_id, 'finances') %}<td>{{ user.bar_account_balance}}</td>{% endif %}
            <td></td>
            {% if hasrole(session.user_id, 'members') %}<td><a href="{{ url_for('members_edit_member', userid=user.id)}}"><img src="static/edit.gif" alt="edit user settings" /></a></td>{% endif %}
        </tr>
{% endfor %}
    </tbody>
</table>
{% endblock %}
